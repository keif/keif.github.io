---
export async function getStaticPaths() {
  const posts = Object.values(import.meta.glob(['../data/blog/*.md', '../data/blog/*.mdx'], { eager: true }));
  const aliasPaths = posts.flatMap((post: any) => {
    const canonicalSlug = post.frontmatter.slug;
    const reserved = ["about", "archives", "now", "search", "tags"];
    const aliases = (post.frontmatter.aliases || []).filter(
      (alias: string) => !reserved.includes(alias.toLowerCase())
    );
    return aliases.map((alias: string) => ({
      params: { slug: alias },
      props: { canonicalSlug },
    }));
  });

  return aliasPaths;
}

const reserved = ["about", "archives", "now", "search", "tags"];
if (reserved.includes(Astro.params.slug)) {
  throw new Error(`Reserved slug: ${Astro.params.slug}`);
}
const { canonicalSlug } = Astro.props;
---

<html>
  <head>
    <meta http-equiv="refresh" content={`0; url=/posts/${canonicalSlug}`} />
    <link rel="canonical" href={`/posts/${canonicalSlug}`} />
  </head>
  <body>
    Redirecting to <a href={`/posts/${canonicalSlug}`}>{canonicalSlug}</a>â€¦
  </body>
</html>