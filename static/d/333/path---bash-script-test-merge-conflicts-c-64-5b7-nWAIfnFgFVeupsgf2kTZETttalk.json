{"data":{"markdownRemark":{"html":"<p>A reoccuring problem I run into at work is handling multiple branches on a dev environment comprised of Java, JavaScript, SQL, and SCSS files.</p>\n<p>It's not an ideal scenario, but utilizing Jenkins, the task is fairly easy in the pipeline - you list the branches you want built, you tell it to deploy (or on a schedule) and it runs through and confirms there is no merge conflicts, before continuing on the pipeline to run the jasmine tests to verify everything is up to snuff on the front-end. Of course, since it's Jenkins, I can kick off the build, then head to the console output and watch for an error, or wait for it to fail.</p>\n<p>But who has time for that? In that time, three new JavaScript frameworks were released, and one failed, and the other already replaced Angular!</p>\n<p>Also, as the code example lives in a gist - my entry may not always match the code (which will be the most up-to-date version).</p>\n<h2>What this script does:</h2>\n<ul>\n<li>for my needs, it checks out <code class=\"language-text\">develop</code> and pulls to be sure it's up to date</li>\n<li>create a branch <code class=\"language-text\">test-merge</code> that is appended with the day/month/seconds</li>\n<li>we reference a <code class=\"language-text\">branches.txt</code> file that holds the branches (each branch on a new line)</li>\n<li>\n<p>for each branch:</p>\n<ul>\n<li>ignores any <code class=\"language-text\"># comments</code></li>\n<li>fetches the branch</li>\n<li>we merge (using <code class=\"language-text\">refs/remotes/origin/</code> so we don't need to check out each branch locally)</li>\n</ul>\n</li>\n<li>output \"SUCCESS\" or \"FAIL\" to <code class=\"language-text\">build-result.txt</code></li>\n<li>output the content of <code class=\"language-text\">build-result.txt</code></li>\n<li>we grep against the file to check if \"FAIL\" is present</li>\n<li>remove <code class=\"language-text\">build-result.txt</code></li>\n<li>checkout <code class=\"language-text\">develop</code> and delete <code class=\"language-text\">test-merge</code></li>\n</ul>\n<h3>What it still needs to do:</h3>\n<ul>\n<li>Stash and save the current code (in case you haven't committed yet) and apply when you're done</li>\n<li>run from the current branch (saving the current branch, switching to <code class=\"language-text\">develop</code>, and switching back to your original branch)</li>\n<li>fix the issue where it's applying to <code class=\"language-text\">develop</code>, requiring a <code class=\"language-text\">reset</code></li>\n</ul>\n<p><div id=\"gist94084227\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-git_merge_check-sh\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"blob-wrapper data type-shell \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\">\n      <tr>\n        <td id=\"file-git_merge_check-sh-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-git_merge_check-sh-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-c\"><span class=\"pl-c\">#!</span>/bin/bash</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-git_merge_check-sh-LC2\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-git_merge_check-sh-LC3\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">function</span> <span class=\"pl-en\">git_merge_test()</span> {</td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-git_merge_check-sh-LC4\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-c\"><span class=\"pl-c\">#</span> pull and update develop</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-git_merge_check-sh-LC5\" class=\"blob-code blob-code-inner js-file-line\">    git checkout develop <span class=\"pl-k\">&amp;&amp;</span> git pull<span class=\"pl-k\">;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-git_merge_check-sh-LC6\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-git_merge_check-sh-LC7\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-c\"><span class=\"pl-c\">#</span> create test merge branch</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-git_merge_check-sh-LC8\" class=\"blob-code blob-code-inner js-file-line\">    test_branch_name=<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>test-merge<span class=\"pl-s\"><span class=\"pl-pds\">$(</span>date <span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span>+%d%m%S<span class=\"pl-pds\">&#39;</span></span><span class=\"pl-pds\">)</span></span><span class=\"pl-pds\">&quot;</span></span><span class=\"pl-k\">;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-git_merge_check-sh-LC9\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-git_merge_check-sh-LC10\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-c1\">echo</span> <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>Creating local testing branch <span class=\"pl-smi\">$test_branch_name</span><span class=\"pl-pds\">&quot;</span></span><span class=\"pl-k\">;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-git_merge_check-sh-LC11\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-git_merge_check-sh-LC12\" class=\"blob-code blob-code-inner js-file-line\">    git checkout -b <span class=\"pl-smi\">$test_branch_name</span><span class=\"pl-k\">;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-git_merge_check-sh-LC13\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-git_merge_check-sh-LC14\" class=\"blob-code blob-code-inner js-file-line\">    branches=<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>branches.txt<span class=\"pl-pds\">&quot;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-git_merge_check-sh-LC15\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-git_merge_check-sh-LC16\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-k\">while</span> IFS=<span class=\"pl-s\"><span class=\"pl-pds\">&#39;</span><span class=\"pl-pds\">&#39;</span></span> <span class=\"pl-c1\">read</span> -r branches <span class=\"pl-k\">||</span> [[ <span class=\"pl-k\">-n</span> <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span><span class=\"pl-smi\">$b</span><span class=\"pl-pds\">&quot;</span></span> ]]<span class=\"pl-k\">;</span> <span class=\"pl-k\">do</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-git_merge_check-sh-LC17\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-k\">if</span> [[ <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span><span class=\"pl-smi\">$b</span><span class=\"pl-pds\">&quot;</span></span> <span class=\"pl-k\">=~</span> ^<span class=\"pl-c\"><span class=\"pl-c\">#</span> ]]; then continue; fi</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-git_merge_check-sh-LC18\" class=\"blob-code blob-code-inner js-file-line\">            git fetch origin <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span><span class=\"pl-smi\">$b</span><span class=\"pl-pds\">&quot;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-git_merge_check-sh-LC19\" class=\"blob-code blob-code-inner js-file-line\">            (git merge --no-edit refs/remotes/origin/<span class=\"pl-smi\">$b</span> <span class=\"pl-k\">&amp;&amp;</span> <span class=\"pl-c1\">echo</span> <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span><span class=\"pl-smi\">$b</span>: SUCCESS<span class=\"pl-pds\">&quot;</span></span> <span class=\"pl-k\">&gt;&gt;</span>build-result.txt) <span class=\"pl-k\">||</span> (git merge --abort <span class=\"pl-k\">&amp;&amp;</span> <span class=\"pl-c1\">echo</span> <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span><span class=\"pl-smi\">$b</span>: FAIL<span class=\"pl-pds\">&quot;</span></span> <span class=\"pl-k\">&gt;&gt;</span>build-result.txt)</td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L20\" class=\"blob-num js-line-number\" data-line-number=\"20\"></td>\n        <td id=\"file-git_merge_check-sh-LC20\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-k\">fi</span><span class=\"pl-k\">;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L21\" class=\"blob-num js-line-number\" data-line-number=\"21\"></td>\n        <td id=\"file-git_merge_check-sh-LC21\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-k\">done</span> <span class=\"pl-k\">&lt;</span> <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span><span class=\"pl-smi\">$branches</span><span class=\"pl-pds\">&quot;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L22\" class=\"blob-num js-line-number\" data-line-number=\"22\"></td>\n        <td id=\"file-git_merge_check-sh-LC22\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L23\" class=\"blob-num js-line-number\" data-line-number=\"23\"></td>\n        <td id=\"file-git_merge_check-sh-LC23\" class=\"blob-code blob-code-inner js-file-line\">    cat build-result.txt</td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L24\" class=\"blob-num js-line-number\" data-line-number=\"24\"></td>\n        <td id=\"file-git_merge_check-sh-LC24\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L25\" class=\"blob-num js-line-number\" data-line-number=\"25\"></td>\n        <td id=\"file-git_merge_check-sh-LC25\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-k\">if</span> grep -F <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span> FAIL<span class=\"pl-pds\">&quot;</span></span> build-result.txt<span class=\"pl-k\">;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L26\" class=\"blob-num js-line-number\" data-line-number=\"26\"></td>\n        <td id=\"file-git_merge_check-sh-LC26\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-k\">then</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L27\" class=\"blob-num js-line-number\" data-line-number=\"27\"></td>\n        <td id=\"file-git_merge_check-sh-LC27\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-c1\">echo</span> <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>Stopping because of a merge conflict in one of the branches<span class=\"pl-pds\">&quot;</span></span></td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L28\" class=\"blob-num js-line-number\" data-line-number=\"28\"></td>\n        <td id=\"file-git_merge_check-sh-LC28\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-k\">fi</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L29\" class=\"blob-num js-line-number\" data-line-number=\"29\"></td>\n        <td id=\"file-git_merge_check-sh-LC29\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L30\" class=\"blob-num js-line-number\" data-line-number=\"30\"></td>\n        <td id=\"file-git_merge_check-sh-LC30\" class=\"blob-code blob-code-inner js-file-line\">    rm build-result.txt<span class=\"pl-k\">;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L31\" class=\"blob-num js-line-number\" data-line-number=\"31\"></td>\n        <td id=\"file-git_merge_check-sh-LC31\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L32\" class=\"blob-num js-line-number\" data-line-number=\"32\"></td>\n        <td id=\"file-git_merge_check-sh-LC32\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-c\"><span class=\"pl-c\">#</span> switch back to develop and delete the test branch</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L33\" class=\"blob-num js-line-number\" data-line-number=\"33\"></td>\n        <td id=\"file-git_merge_check-sh-LC33\" class=\"blob-code blob-code-inner js-file-line\">    git checkout develop<span class=\"pl-k\">;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L34\" class=\"blob-num js-line-number\" data-line-number=\"34\"></td>\n        <td id=\"file-git_merge_check-sh-LC34\" class=\"blob-code blob-code-inner js-file-line\">    git reset --hard HEAD<span class=\"pl-k\">;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L35\" class=\"blob-num js-line-number\" data-line-number=\"35\"></td>\n        <td id=\"file-git_merge_check-sh-LC35\" class=\"blob-code blob-code-inner js-file-line\">    git branch -D <span class=\"pl-smi\">$test_branch_name</span><span class=\"pl-k\">;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-git_merge_check-sh-L36\" class=\"blob-num js-line-number\" data-line-number=\"36\"></td>\n        <td id=\"file-git_merge_check-sh-LC36\" class=\"blob-code blob-code-inner js-file-line\">}<span class=\"pl-k\">;</span></td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/keif/5f5c93395e06a515b35f1bacf2399db8/raw/d2ae879a484576c97e823103354bbacd1524e470/git_merge_check.sh\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/keif/5f5c93395e06a515b35f1bacf2399db8#file-git_merge_check-sh\">git_merge_check.sh</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div>\n</p>","timeToRead":3,"frontmatter":{"path":"/bash-script-test-merge-conflicts","title":"Bash Script - test merge conflicts","date":"13th January, 2019.","category":"Code"}}},"pageContext":{}}